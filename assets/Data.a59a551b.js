import{G as Ve,a as b,b as z,o as F,j as $e,H as Ke,c as i,I as ue,i as c,d as O,k as Qe,s as P,S as H,F as ee,e as We,f as ke,t as p,A as Xe,B as qe,J as ie}from"./index.ee425c77.js";const et="/assets/detroitmap.08adfdc9.jpg";async function tt(l){let e="";return l.zip_code.forEach(s=>e+="zip_code="+s.id+"&"),l.type.forEach(s=>e+="type="+s.id+"&"),l.pollutant.forEach(s=>e+="pollutant="+s.id+"&"),(await(await fetch(`https://mrapid-api3-r2oaltsiuq-uc.a.run.app/sensor?${e}`)).json()).SensorList}async function lt(l){let e="sensor=";return l.sensor.forEach(s=>e+=s.id+","),e+="&",l.pollutant.forEach(s=>e+="pollutant="+s.id+"&"),l.pollutant.forEach(s=>e+="unit="+s.name.split(" ").pop()+"&"),e+="start="+l.start+"&",e+="end="+l.end+"&",e+="step="+l.step+"&",await(await fetch(`https://mrapid-api3-r2oaltsiuq-uc.a.run.app/history?${e}`)).json()}const nt=function(l,e,n){let t="download.csv",s=[];if(e.length==1){console.log(e),t=e[0].name+" data.csv";let f=["date","time"],v=[];var r={};for(let _=0;_<n.length;_++)f.push(n[_].name),v.push("NA"),r[n[_].id]=v.length+1;let $=new Date(l[0].time);s.push(f.join(","));let y=$.toLocaleString().split(", ");y=y.concat(v);for(const _ of l){let E=new Date(_.time);E.getTime()!=$.getTime()&&(s.push(y.join(",")),$=E,y=$.toLocaleString().split(", "),y=y.concat(v)),y[r[_.sensor_id]]=_.value}s.push(y.join(",")),s=s.join(`
`)}else t="oops haven't got here yet TODO: multiple pollutants";const d=new Blob([s],{type:"text/csv"}),h=window.URL.createObjectURL(d),w=document.createElement("a");w.setAttribute("href",h),w.setAttribute("download",t),w.click()},st=l=>{const e=Ve({multiple:!1,disabled:!1,optionToValue:a=>a,isOptionDisabled:a=>!1},l),n=a=>{if(e.multiple&&Array.isArray(a))return a;if(!e.multiple&&!Array.isArray(a))return a!==null?[a]:[];throw new Error(`Incompatible value type for ${e.multiple?"multple":"single"} select.`)},[t,s]=b(e.initialValue!==void 0?n(e.initialValue):[]),r=()=>e.multiple?t():t()[0]||null,d=a=>s(n(a)),h=()=>s([]),w=()=>!!(e.multiple?r().length:r());z(F(t,()=>e.onChange?.(r()),{defer:!0}));const[f,v]=b(""),$=()=>v(""),y=()=>!!f().length;z(F(f,a=>e.onInput?.(a),{defer:!0})),z(F(f,a=>{a&&!S()&&D(!0)},{defer:!0}));const _=typeof e.options=="function"?$e(()=>e.options(f()),e.options(f())):()=>e.options,E=()=>_().length,A=a=>{if(e.isOptionDisabled(a))return;const N=e.optionToValue(a);e.multiple?d([...t(),N]):(d(N),L(!1)),D(!1)},[de,L]=b(!1),[S,D]=b(!1),K=()=>D(!S()),[j,M]=b(-1),T=()=>_()[j()],pe=a=>a===T(),te=a=>{E()||M(-1);const N=E()-1,se=a==="next"?1:-1;let R=j()+se;R>N&&(R=0),R<0&&(R=N),M(R)},fe=()=>te("previous"),m=()=>te("next");z(F(_,a=>{S()&&M(Math.min(0,a.length-1))},{defer:!0})),z(F(()=>e.disabled,a=>{a&&S()&&D(!1)})),z(F(S,a=>{a?(j()===-1&&m(),L(!0)):(j()>-1&&M(-1),v(""))},{defer:!0})),z(F(j,a=>{a>-1&&!S()&&D(!0)},{defer:!0}));const he=()=>L(!0),le=()=>{L(!1),D(!1)},Q=a=>a.preventDefault(),me=a=>{!e.disabled&&!y()&&K()},ne=a=>{v(a.target.value)},W=a=>{switch(a.key){case"ArrowDown":m();break;case"ArrowUp":fe();break;case"Enter":if(S()&&T()){A(T());break}return;case"Escape":if(S()){D(!1);break}return;case"Delete":case"Backspace":if(f())return;if(e.multiple){const N=r();d([...N.slice(0,-1)])}else h();break;case" ":if(f())return;S()?T()&&A(T()):D(!0);break;case"Tab":if(T()&&S()){A(T());break}return;default:return}a.preventDefault(),a.stopPropagation()};return{options:_,value:r,setValue:d,hasValue:w,clearValue:h,inputValue:f,setInputValue:v,hasInputValue:y,clearInputValue:$,isOpen:S,setIsOpen:D,toggleOpen:K,isActive:de,setIsActive:L,get multiple(){return e.multiple},get disabled(){return e.disabled},pickOption:A,isOptionFocused:pe,isOptionDisabled:e.isOptionDisabled,onFocusIn:he,onFocusOut:le,onMouseDown:Q,onClick:me,onInput:ne,onKeyDown:W}},ot=p("<div></div>",2),at=p('<div class="solid-select-control"></div>',2),rt=p('<div class="solid-select-placeholder"></div>',2),it=p('<div class="solid-select-single-value"></div>',2),ct=p('<div class="solid-select-multi-value"><button type="button" class="solid-select-multi-value-remove">\u2A2F</button></div>',4),ut=p('<input class="solid-select-input" type="text" tabindex="0" autocomplete="off" autocapitalize="none" size="1">',1),dt=p('<div class="solid-select-list"></div>',2),Pe=p('<div class="solid-select-list-placeholder"></div>',2),pt=p('<div class="solid-select-option"></div>',2),Oe=Xe(),J=()=>{const l=qe(Oe);if(!l)throw new Error("No SelectContext found in ancestry.");return l},ce=l=>{const[e,n]=Ke(Ve({format:(s,r)=>s,placeholder:"Select...",readonly:typeof l.options!="function",loading:!1,loadingPlaceholder:"Loading...",emptyPlaceholder:"No options"},l),["options","optionToValue","isOptionDisabled","multiple","disabled","onInput","onChange"]),t=st(e);return z(F(()=>n.initialValue,s=>s!==void 0&&t.setValue(s))),i(Oe.Provider,{value:t,get children(){return i(ft,{get class(){return n.class},get children(){return[i(ht,{get id(){return n.id},get name(){return n.name},get format(){return n.format},get placeholder(){return n.placeholder},get autofocus(){return n.autofocus},get readonly(){return n.readonly}}),i($t,{get loading(){return n.loading},get loadingPlaceholder(){return n.loadingPlaceholder},get emptyPlaceholder(){return n.emptyPlaceholder},get format(){return n.format}})]}})}})},ft=l=>{const e=J();return(()=>{const n=ot.cloneNode(!0);return n.$$mousedown=t=>{e.onMouseDown(t),t.currentTarget.getElementsByTagName("input")[0].focus()},ue(n,"focusout",e.onFocusOut,!0),ue(n,"focusin",e.onFocusIn,!0),c(n,()=>l.children),O(t=>{const s=`solid-select-container ${l.class!==void 0?l.class:""}`,r=e.disabled;return s!==t._v$&&Qe(n,t._v$=s),r!==t._v$2&&P(n,"data-disabled",t._v$2=r),t},{_v$:void 0,_v$2:void 0}),n})()},ht=l=>{const e=J(),n=t=>{const s=e.value();e.setValue([...s.slice(0,t),...s.slice(t+1)])};return(()=>{const t=at.cloneNode(!0);return ue(t,"click",e.onClick,!0),c(t,i(H,{get when(){return $e(()=>!e.hasValue())()&&!e.hasInputValue()},get children(){return i(mt,{get children(){return l.placeholder}})}}),null),c(t,i(H,{get when(){return $e(()=>!!(e.hasValue()&&!e.multiple))()&&!e.hasInputValue()},get children(){return i(gt,{get children(){return l.format(e.value(),"value")}})}}),null),c(t,i(H,{get when(){return e.hasValue()&&e.multiple},get children(){return i(ee,{get each(){return e.value()},children:(s,r)=>i(bt,{onRemove:()=>n(r()),get children(){return l.format(s,"value")}})})}}),null),c(t,i(vt,{get id(){return l.id},get name(){return l.name},get autofocus(){return l.autofocus},get readonly(){return l.readonly}}),null),O(s=>{const r=e.multiple,d=e.hasValue(),h=e.disabled;return r!==s._v$3&&P(t,"data-multiple",s._v$3=r),d!==s._v$4&&P(t,"data-has-value",s._v$4=d),h!==s._v$5&&P(t,"data-disabled",s._v$5=h),s},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})()},mt=l=>(()=>{const e=rt.cloneNode(!0);return c(e,()=>l.children),e})(),gt=l=>(()=>{const e=it.cloneNode(!0);return c(e,()=>l.children),e})(),bt=l=>(J(),(()=>{const e=ct.cloneNode(!0),n=e.firstChild;return c(e,()=>l.children,n),n.$$click=t=>{t.stopPropagation(),l.onRemove()},e})()),vt=l=>{const e=J();return(()=>{const n=ut.cloneNode(!0);return n.$$mousedown=t=>{t.stopPropagation()},n.$$keydown=t=>{e.onKeyDown(t),t.defaultPrevented||t.key==="Escape"&&(t.preventDefault(),t.stopPropagation(),t.target.blur())},ue(n,"input",e.onInput,!0),O(t=>{const s=l.id,r=l.name,d=e.multiple,h=e.isActive(),w=l.autofocus,f=l.readonly,v=e.disabled;return s!==t._v$6&&P(n,"id",t._v$6=s),r!==t._v$7&&P(n,"name",t._v$7=r),d!==t._v$8&&P(n,"data-multiple",t._v$8=d),h!==t._v$9&&P(n,"data-is-active",t._v$9=h),w!==t._v$10&&(n.autofocus=t._v$10=w),f!==t._v$11&&(n.readOnly=t._v$11=f),v!==t._v$12&&(n.disabled=t._v$12=v),t},{_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),O(()=>n.value=e.inputValue()),n})()},$t=l=>{const e=J();return i(H,{get when(){return e.isOpen()},get children(){const n=dt.cloneNode(!0);return c(n,i(H,{get when(){return!l.loading},get fallback(){return(()=>{const t=Pe.cloneNode(!0);return c(t,()=>l.loadingPlaceholder),t})()},get children(){return i(ee,{get each(){return e.options()},get fallback(){return(()=>{const t=Pe.cloneNode(!0);return c(t,()=>l.emptyPlaceholder),t})()},children:t=>i(_t,{option:t,get children(){return l.format(t,"option")}})})}})),n}})},_t=l=>{const e=J(),n=t=>{z(()=>{e.isOptionFocused(l.option)&&t.scrollIntoView({block:"nearest"})})};return(()=>{const t=pt.cloneNode(!0);return t.$$click=()=>e.pickOption(l.option),We(n,t),c(t,()=>l.children),O(s=>{const r=e.isOptionDisabled(l.option),d=e.isOptionFocused(l.option);return r!==s._v$13&&P(t,"data-disabled",s._v$13=r),d!==s._v$14&&P(t,"data-focused",s._v$14=d),s},{_v$13:void 0,_v$14:void 0}),t})()};ke(["focusin","focusout","mousedown","click","input","keydown"]);const St=p('<div><h3 style="padding:auto;"> Data</h3><table class="datatable"></table></div>',6),yt=p("<tr></tr>",2),xt=p("<th></th>",2),wt=p('<div class="flex flex-1 flex-col max-w-100 gap-3"><label for="sensor">Select sensors to view their data</label></div>',4),Ct=p('<div class="data-container"><form><h3>Filter Sensors</h3><div class="data-form-item"><div class="flex flex-1 flex-col max-w-100 gap-3"><label for="zip_code">Filter sensors by zip code</label></div><label for="zip_select_all" class="filter-button-container"><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Select all zip codes</button><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Clear all selected zip codes</button></label><div class="flex flex-1 flex-col max-w-100 gap-3"><label for="type">Filter sensors by monitor type</label></div><label for="monitor_select_all" class="filter-button-container"><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Select all monitor types</button><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Clear all selected monitor types</button></label><div class="flex flex-1 flex-col max-w-100 gap-3"><label for="pollutant">Filter sensors by pollutants</label></div><label for="pollutant_select_all" class="filter-button-container"><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Select all pollutants</button><button type="button" class="filter-button" style="border-radius:5px;border:1px solid;">Clear all selected pollutants</button></label></div><h3>Select Sensors</h3><div class="data-form-item"></div><h3>Filter Sensor Data </h3><label class="data-form-item">Start time/date<input type="date" name="start-time" class="text-input"></label><label class="data-form-item">End time/date<input type="date" name="end-time" class="text-input"></label><label class="data-form-item">Time step<select class="select"><option value="h">Hourly</option><option value="d">Daily</option><option value="m">Monthly</option><option value="y">Yearly</option></select></label><label class="data-form-item">Choose the pollutant to display<select class="select"></select></label></form></div>',66),Dt=p("<h6></h6>",2),Pt=p('<label class="data-form-item" for="graphSubmit"><button id="graphSubmit" type="submit" name="submit" class="icon-btn btn-secondary">Show A Graph of the data</button></label>',4),Vt=p('<label class="data-form-item" for="downloadSubmit"><button id="downloadSubmit" type="submit" name="submit" class="icon-btn btn-secondary">Download A CSV</button></label>',4),kt=p('<label class="data-form-item" for="tableSubmit"><button id="tableSubmit" type="submit" name="submit" class="icon-btn btn-secondary">Show A Table</button></label>',4),Ot=p("<option></option>",2),G=(l,e)=>({id:l,name:e});async function Tt(){const e=await(await fetch("https://mrapid-api3-r2oaltsiuq-uc.a.run.app/zipcodes")).json();let n=[];for(let t=0;t<e.zipcode_list.length;t++)n.push(G(e.zipcode_list[t].zip_code,e.zipcode_list[t].zip_code));return n}async function Nt(){const e=await(await fetch("https://mrapid-api3-r2oaltsiuq-uc.a.run.app/parameterList")).json();let n=[];for(let t=0;t<e.results.length;t++)n.push(G(e.results[t].name,e.results[t].displayName+" "+e.results[t].units));return n}function It(){const l=[],e=[],n=[],[t,s]=b(l),[r,d]=b(e),[h,w]=b(n),[f,v]=b([{id:"pm2.5",name:"PM 2.5 \xB5g/m\xB3"}]),[$,y]=b([]),[_,E]=b(!1);let A=new Date,de=("0"+A.getDate()).slice(-2),L=("0"+(A.getMonth()+1)).slice(-2);const[S,D]=b("2023-01-01"),[K,j]=b(A.getFullYear()+"-"+L+"-"+de),[M,T]=b("h"),pe=o=>{T(o.currentTarget.value),console.log(o.currentTarget.value),o.preventDefault()},te=o=>{v([{id:o.currentTarget.value,name:o.currentTarget[o.currentTarget.selectedIndex].text}]),o.preventDefault()},[fe,m]=b(""),he=o=>{o.preventDefault();let u=W();if(u.status=="No results")return m("No data for these parameters"),0;if(u.message)return m("Please check that you've selected sensors"),0;m(""),u=u.results,console.log(f()),nt(u,f(),$())},le=()=>({zip_code:t(),type:r(),pollutant:h()}),[Q]=ie(le,tt),me=o=>{y(o),Q()},ne=()=>({pollutant:f(),sensor:$(),start:S(),end:K(),step:M()}),[W]=ie(ne,lt),[a]=ie(Tt),N=o=>{s(o),a()},se=[G("DST","DST"),G("OAQ","Open Air"),G("PAR","Purple Air"),G("TSI","TSI"),G("CLA","CLARITY")],R=o=>{d(o)},[U]=ie(Nt),Te=o=>{w(o),U(),h().length==1&&v(o)},oe=(o,u)=>o.name,Ne=()=>{s(a),a()},Ie=()=>{s([]),a()},ze=()=>{d(se)},Ee=()=>{d([])},Ae=()=>{w(U),U()},Fe=()=>{w([]),U()},Le=o=>{let u=ne(),V=le();if(o.preventDefault(),u.start.length===0){m("Please provide a start time for the graph");return}else if(u.end.length===0){m("Please provide an end time for the graph");return}else if(u.step.length===0){m("Please provide a time step for the graph");return}else if(V.zip_code.length===0){m("Please provide at least one zip code for the graph");return}else if(V.pollutant.length===0){m("Please provide at least one pollutant for the graph");return}let B=new Date(u.start),I=new Date(u.end);if(B>I){m("Please provide a start date that is before the end date, or the same as the end date");return}m("");let C=W();console.log(C),C=C.results},je=o=>{E(!1),E(!0),o.preventDefault()};function Me(){console.log($());let o=W();if(o.status=="No results")return m("No data for these parameters"),[];if(o.message)return m("Please check that you've selected sensors"),[];m(""),o=o.results;let u=["date","time"],V=[];var B={};for(let x=0;x<$().length;x++)u.push($()[x].name),V.push("NA"),B[$()[x].id]=V.length+1;let I=[u],C=new Date(o[0].time);console.log(C.toLocaleString().split(", ")),console.log(V);let Z=[].concat(C.toLocaleString().split(", "),V);console.log("hhhhhhh");for(const x of o){let k=new Date(x.time);k.getTime()!=C.getTime()&&(I.push(Z),C=k,Z=[].concat(C.toLocaleString().split(", "),V)),Z[B[x.sensor_id]]=x.value}return I.push(Z),(()=>{const x=St.cloneNode(!0),k=x.firstChild,ae=k.firstChild,re=k.nextSibling;return c(k,()=>f()[0].name,ae),c(re,i(ee,{each:I,children:ge=>(()=>{const Y=yt.cloneNode(!0);return c(Y,i(ee,{each:ge,children:be=>(()=>{const X=xt.cloneNode(!0);return c(X,be),X})()})),Y})()})),x})()}return[(()=>{const o=Ct.cloneNode(!0),u=o.firstChild,V=u.firstChild,B=V.nextSibling,I=B.firstChild;I.firstChild;const C=I.nextSibling,Z=C.firstChild,x=Z.nextSibling,k=C.nextSibling;k.firstChild;const ae=k.nextSibling,re=ae.firstChild,ge=re.nextSibling,Y=ae.nextSibling;Y.firstChild;const be=Y.nextSibling,X=be.firstChild,Re=X.nextSibling,Be=B.nextSibling,_e=Be.nextSibling,Ze=_e.nextSibling,Se=Ze.nextSibling,Ge=Se.firstChild,ye=Ge.nextSibling,xe=Se.nextSibling,He=xe.firstChild,we=He.nextSibling,Ce=xe.nextSibling,Ue=Ce.firstChild,De=Ue.nextSibling,Ye=Ce.nextSibling,Je=Ye.firstChild,ve=Je.nextSibling;return c(I,i(ce,{class:"search",id:"zip_code",multiple:!0,get initialValue(){return t()},label:"Select sensors",placeholder:"Search by zip code",onChange:N,format:oe,options:a,isOptionDisabled:g=>t().length!=0?t().includes(g):!1}),null),Z.$$click=Ne,x.$$click=Ie,c(k,i(ce,{class:"search",id:"type",multiple:!0,label:"Select sensors",placeholder:"Search by monitor type",get initialValue(){return r()},onChange:R,format:oe,options:se,isOptionDisabled:g=>r().length!=0?r().includes(g):!1}),null),re.$$click=ze,ge.$$click=Ee,c(Y,i(ce,{class:"search",id:"pollutant",multiple:!0,get initialValue(){return h()},label:"Select sensors",placeholder:"Search by pollutant",onChange:Te,format:oe,options:U,isOptionDisabled:g=>h().length!=0?h().includes(g):!1}),null),X.$$click=Ae,Re.$$click=Fe,c(_e,i(H,{get when(){return!Q.loading},get fallback(){return"Searching..."},get children(){const g=wt.cloneNode(!0);return g.firstChild,c(g,i(ce,{class:"search",id:"sensor",multiple:!0,label:"sensor selector",placeholder:"Search for specific sensors",onChange:me,format:oe,get options(){return Q()},isOptionDisabled:q=>$().length!=0?$().includes(q):!1}),null),g}})),ye.addEventListener("change",g=>D(g.currentTarget.value)),we.addEventListener("change",g=>j(g.currentTarget.value)),De.addEventListener("change",pe),ve.addEventListener("change",te),c(ve,i(ee,{get each(){return U()},children:g=>(()=>{const q=Ot.cloneNode(!0);return c(q,()=>g.name),O(()=>q.value=g.id),q})()})),O(()=>ye.value=S()),O(()=>we.value=K()),O(()=>De.value=M()),O(()=>ve.value=h().length==1?h()[0].id:"pm2.5"),o})(),(()=>{const o=Dt.cloneNode(!0);return c(o,fe),o})(),(()=>{const o=Pt.cloneNode(!0),u=o.firstChild;return u.$$click=Le,o})(),(()=>{const o=Vt.cloneNode(!0),u=o.firstChild;return u.$$click=he,o})(),(()=>{const o=kt.cloneNode(!0),u=o.firstChild;return u.$$click=je,o})(),i(H,{get when(){return _()},get children(){return i(Me,{})}})]}ke(["click"]);const zt=p("<div></div>",2),Et=p('<section class="page-data"><div class="data-form"><form><h1>Download sensor data</h1></form><div class="data-image-container"><h3>Map of Detroit Zip Codes</h3><div class="data-image"><img alt="map of detroit zipcodes"></div>For a complete list of MI zip codes, refer to this <a href="https://www.michigan.gov/dtmb/-/media/Project/Websites/dtmb/Services/GIS/Static-Maps/Boundaries/ZIPCodeMap_LP102209.pdf?rev=ef32903cd06c47688b6f3978263a40f4&amp;hash=FB40296EEACD32BC792E28F054C0E47D" target="_blank" rel="noopener noreferrer">document</a>.</div></div></section>',17),At=[];function Ft(){const[l]=b(At);return(()=>{const e=zt.cloneNode(!0);return c(e,i(It,{setSensors:l})),e})()}const jt=()=>(()=>{const l=Et.cloneNode(!0),e=l.firstChild,n=e.firstChild;n.firstChild;const t=n.nextSibling,s=t.firstChild,r=s.nextSibling,d=r.firstChild;return c(n,i(Ft,{name:"Solid"}),null),P(d,"src",et),l})();export{jt as default};
